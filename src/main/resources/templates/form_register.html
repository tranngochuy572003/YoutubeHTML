<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/form_register.css}"/>

</head>
<body>
<form onsubmit="submit()" id="registerForm">
    <div class="form">
        <label>Full name:</label>
        <input type="text" id="name" placeholder="Enter your name" required>
        <label>Email</label>
        <input type="email" id="email" placeholder="Enter your email" required>
    </div>
    <div class="inline">
        <label>Gender:</label>
        <select id="gender" required>
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>
    </div>
    <br>
    <button class="submit" type="submit">Submit</button>
</form>
<div href="#" hidden onclick="getInfo()"><a>Get Info</a></div>

<script>
    $(document).ready(function () {
        $('#registerForm').on('submit', function (event) {
            event.preventDefault();
            submit()

        });
    });

    function getInfo(user) {
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "http://localhost:8080/getInfo",
            data: JSON.stringify(user),
        });

    }

    function submit() {
        var user = {
            name: $('#name').val(),
            email: $('#email').val(),
            gender: $('#gender').val()
        };

        fetch("http://localhost:8080/confirmRegisterSuccess", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(user)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok " + response.statusText);
                }
                return response.json();
            })
            .then(responseUser => {
                console.log("User received from API:", responseUser.name);
                window.location.href = "/displayInfo?name=" + encodeURIComponent(responseUser.name) +
                    "&email=" + encodeURIComponent(responseUser.email) +
                    "&gender=" + encodeURIComponent(responseUser.gender);
                getInfo(responseUser);
            })
            .catch(error => {
                console.error("Failed to fetch user from API:", error);
            });

        //
        // var request = new XMLHttpRequest();
        // request.open("POST", "http://localhost:8080/confirmRegisterSuccess")
        //
        // var responseUser;
        // request.onload = function () {
        //     responseUser = JSON.parse(request.responseText);
        // };
        // request.setRequestHeader("Content-Type", "application/json");
        // request.send(JSON.stringify(user))

        // getInfo(responseUser)

    }
</script>
</body>
</html>
